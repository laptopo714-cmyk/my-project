# إدارة الأقسام والفيديوهات

هذا الدليل يشرح كيفية استخدام نظام إدارة الأقسام والفيديوهات في لوحة التحكم.

## المميزات

- إنشاء وتعديل وحذف الأقسام
- إضافة فيديوهات عن طريق روابط خارجية (مثل يوتيوب أو جوجل درايف)
- ربط الفيديوهات بالأقسام المناسبة
- تصفية وبحث في الأقسام والفيديوهات
- عرض إحصائيات الأقسام والفيديوهات

## إعداد قاعدة البيانات

لإعداد قاعدة البيانات، قم بتنفيذ الخطوات التالية:

1. تأكد من وجود ملف `.env` في المجلد الرئيسي للمشروع يحتوي على متغيرات البيئة اللازمة:

```
NEXT_PUBLIC_SUPABASE_URL=https://your-project-url.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

2. قم بتشغيل سكريبت الهجرة لإنشاء جداول الأقسام والفيديوهات:

```bash
node scripts/run-migration.mjs create_sections_videos_tables.sql
```

## استخدام واجهة إدارة الأقسام والفيديوهات

### إدارة الأقسام

1. انتقل إلى لوحة التحكم وانقر على "الأقسام والفيديوهات" في القائمة الجانبية.
2. انقر على زر "إضافة قسم جديد" لإنشاء قسم جديد.
3. املأ النموذج بالمعلومات المطلوبة:
   - العنوان: عنوان القسم
   - الوصف: وصف تفصيلي للقسم
   - الصورة المصغرة: رابط لصورة مصغرة للقسم (اختياري)
   - الحالة: مسودة، منشور، أو مؤرشف
   - مميز: حدد هذا الخيار لجعل القسم مميزًا
4. انقر على "حفظ" لإنشاء القسم.

### إدارة الفيديوهات

1. انتقل إلى لوحة التحكم وانقر على "الأقسام والفيديوهات" في القائمة الجانبية.
2. انقر على زر "إضافة فيديو جديد" لإضافة فيديو جديد.
3. املأ النموذج بالمعلومات المطلوبة:
   - العنوان: عنوان الفيديو
   - الوصف: وصف تفصيلي للفيديو
   - الرابط: رابط الفيديو الخارجي (يوتيوب، جوجل درايف، إلخ)
   - القسم: اختر القسم الذي ينتمي إليه الفيديو
   - المدة بالدقائق: مدة الفيديو بالدقائق
   - الصورة المصغرة: رابط لصورة مصغرة للفيديو (اختياري)
   - الحالة: مسودة، منشور، أو مؤرشف
4. انقر على "حفظ" لإضافة الفيديو.

### البحث والتصفية

- يمكنك البحث في الأقسام والفيديوهات باستخدام شريط البحث.
- يمكنك تصفية الأقسام حسب الحالة (مسودة، منشور، مؤرشف).
- يمكنك تصفية الفيديوهات حسب الحالة والقسم.

## واجهة برمجة التطبيقات (API)

### خدمة الأقسام

```typescript
// الحصول على الأقسام مع التصفحة والتصفية
SectionService.getSections({ page, limit, search, status })

// الحصول على قسم بواسطة المعرف
SectionService.getSectionById(id)

// إنشاء قسم جديد
SectionService.createSection(sectionData)

// تحديث قسم
SectionService.updateSection(id, sectionData)

// حذف قسم
SectionService.deleteSection(id)

// الحصول على إحصائيات الأقسام
SectionService.getStats()
```

### خدمة الفيديوهات

```typescript
// الحصول على الفيديوهات مع التصفحة والتصفية
VideoService.getVideos({ page, limit, search, status, section_id })

// الحصول على فيديو بواسطة المعرف
VideoService.getVideoById(id)

// إنشاء فيديو جديد
VideoService.createVideo(videoData)

// تحديث فيديو
VideoService.updateVideo(id, videoData)

// حذف فيديو
VideoService.deleteVideo(id)
```

## الأمان

تم تطبيق سياسات أمان على مستوى الصفوف (RLS) في قاعدة البيانات Supabase لضمان أن:

- يمكن للمشرفين فقط إدارة الأقسام والفيديوهات (إنشاء، تعديل، حذف).
- يمكن للطلاب فقط عرض الأقسام والفيديوهات المنشورة.
- لا يمكن للطلاب عرض الفيديوهات في الأقسام غير المنشورة.